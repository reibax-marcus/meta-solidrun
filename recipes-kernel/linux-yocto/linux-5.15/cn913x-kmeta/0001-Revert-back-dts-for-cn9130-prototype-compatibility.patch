From 7cb89e33c6407a65aa0019892473ba8d54943d9f Mon Sep 17 00:00:00 2001
From: Xabier Marquiegui <xmarquiegui@ainguraiiot.com>
Date: Mon, 14 Mar 2022 16:23:30 +0100
Subject: [PATCH] Revert back dts for cn9130 prototype compatibility

---
 .../arm64/boot/dts/marvell/cn9130-cf-base.dts | 81 ++++++-------------
 1 file changed, 23 insertions(+), 58 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts b/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts
index b04e0d0bd6ee..384788fb3f1d 100644
--- a/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts
+++ b/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts
@@ -2,16 +2,15 @@
 /*
  * Copyright SolidRun Ltd.
  *
- * Device tree for the  CN9130 based SOM.
+ * Device tree for the  CN9130 based COM Express type 7 board.
  */
 
 #include "cn9130.dtsi"
 
 #include <dt-bindings/gpio/gpio.h>
-#include <dt-bindings/input/input.h>
 
 / {
-	model = "SolidRun CN9130 based SOM Clearfog Base";
+	model = "SolidRun CN9130 based COM Express type 7";
 
 	chosen {
 		stdout-path = "serial0:115200n8";
@@ -101,20 +100,6 @@ cp0_sfp_eth0: sfp-eth@0 {
 		tx-fault-gpio = <&expander0 13 GPIO_ACTIVE_HIGH>;
 		maximum-power-milliwatt = <2000>;
 	};
-
-	keys {
-                compatible = "gpio-keys";
-                pinctrl-0 = <&cp0_button_pin>;
-                pinctrl-names = "default";
-
-		button0{
-			/* SW3 button */
-			label = "SW3";
-			gpios = <&cp0_gpio2 0 GPIO_ACTIVE_LOW>;
-			linux,can-disable;
-			linux,code = <BTN_0>;
-		};
-	};
 };
 
 &uart0 {
@@ -151,17 +136,17 @@ &cp0_i2c0 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&cp0_i2c0_pins>;
 	clock-frequency = <100000>;
-
+	/* EEPROM */
 	/*
 	 * PCA9655 GPIO expander, up to 1MHz clock.
 	 *  0-CON3 CLKREQ#
 	 *  1-CON3 PERST#
-	 *  2-CON2 PERST#
+	 *  2-
 	 *  3-CON3 W_DISABLE
-	 *  4-CON2 CLKREQ#
+	 *  4-
 	 *  5-USB3 overcurrent
 	 *  6-USB3 power
-	 *  7-CON2 W_DISABLE
+	 *  7-
 	 *  8-JP4 P1
 	 *  9-JP4 P4
 	 * 10-JP4 P5
@@ -220,10 +205,9 @@ mikrobus_adc: mcp3021@4c {
 		reg = <0x4c>;
 	};
 
-	/*EEPROM on the SOM */
-	eeprom@53 {
+	eeprom@52 {
 		compatible = "atmel,24c02";
-		reg = <0x53>;
+		reg = <0x52>;
 		pagesize = <16>;
 	};
 };
@@ -236,10 +220,10 @@ &cp0_i2c1 {
 	pinctrl-0 = <&cp0_i2c1_pins>;
 };
 
-&cp0_gpio1 {
-	phy_reset { /* Release switch reset */
+&cp0_gpio2 {
+	phy_reset { /* Release phy1 reset */
 		gpio-hog;
-		gpios = <27 GPIO_ACTIVE_HIGH>;
+		gpios = <12 GPIO_ACTIVE_HIGH>;
 		output-high;
 	};
 };
@@ -270,13 +254,6 @@ &cp0_usb3_0 {
 	phy-names = "usb";
 };
 
-&cp0_usb3_1 {
-        status = "okay";
-	usb-phy = <&cp0_usb3_0_phy1>;
-};
-
-
-
 /* SRDS #2 - SFP+ 10GE */
 &cp0_eth0 {
 	status = "okay";
@@ -310,21 +287,13 @@ &cp0_pcie2 {
 	reset-gpios = <&expander0 1 GPIO_ACTIVE_LOW>;
 };
 
-/* GE PHY RGMII */
-&cp0_eth2 {
-        status = "okay";
-	phy = <&phy0>;
-        phy-mode = "rgmii-id";
-	pinctrl-0 = <&cp0_ge2_rgmii_pins>;
-};
-
 &cp0_sdhci0 {
 	status = "okay";
 	pinctrl-names = "default";
 	pinctrl-0 = <&cp0_sdhci_pins
 			&cp0_sdhci_cd_pins>;
 	bus-width = <4>;
-	cd-gpios = <&cp0_gpio2 11 GPIO_ACTIVE_LOW>;
+	cd-gpios = <&cp0_gpio2 23 GPIO_ACTIVE_LOW>;
 	no-1-8-v;
 	vqmmc-supply = <&v_3_3>;
 	vmmc-supply = <&v_3_3>;
@@ -363,15 +332,15 @@ cp0_i2c1_pins: cp0-i2c-pins-1 {
 			marvell,pins = "mpp35", "mpp36";
 			marvell,function = "i2c1";
 		};
-		cp0_ge2_rgmii_pins: cp0-ge-rgmii-pins-0 {
-			marvell,pins =	"mpp44", "mpp45", "mpp46",
-					"mpp47", "mpp48", "mpp49",
-					"mpp50", "mpp51", "mpp52",
-					"mpp53", "mpp54", "mpp55";
-			marvell,function = "ge1";
+		cp0_ge1_rgmii_pins: cp0-ge-rgmii-pins-0 {
+			marvell,pins =	"mpp0", "mpp1", "mpp2",
+					"mpp3", "mpp4", "mpp5",
+					"mpp6", "mpp7", "mpp8",
+					"mpp9", "mpp10", "mpp11";
+			marvell,function = "ge0";
 		};
 		cp0_sdhci_cd_pins: cp0-sdhci-cd-pins-0 {
-			marvell,pins = "mpp43";
+			marvell,pins = "mpp55";
 			marvell,function = "sdio";
 		};
 		cp0_sdhci_pins: cp0-sdhi-pins-0 {
@@ -383,14 +352,10 @@ cp0_spi1_pins: cp0-spi-pins-1 {
 			marvell,pins = "mpp12", "mpp13", "mpp14", "mpp15", "mpp16";
 			marvell,function = "spi1";
 		};
-/*		cp0_rcvr_clk_pins: cp0-rcvr-clk-pins {
-			marvell, pins = "mpp40";
-                        marvell,function = "synce1";
-		};*/
-		cp0_button_pin: cp0-button-pin {
-                	marvell,pins = "mpp32";
-                	marvell,function = "gpio";
-        	};
+		cp0_eth2_phy_reset: copper-eth-phy-reset {
+			marvell,pins = "mpp44";
+			marvell,function = "gpio";
+		};
 	};
 };
 
-- 
2.25.1

